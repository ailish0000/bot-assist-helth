"""
üß† –û–±–ª–µ–≥—á–µ–Ω–Ω—ã–π NLP –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –¥–ª—è –±–æ—Ç–∞-–Ω—É—Ç—Ä–∏—Ü–∏–æ–ª–æ–≥–∞
–í–µ—Ä—Å–∏—è –±–µ–∑ —Ç—è–∂–µ–ª—ã—Ö ML –º–æ–¥–µ–ª–µ–π –¥–ª—è –±—ã—Å—Ç—Ä–æ–π –∑–∞–≥—Ä—É–∑–∫–∏
"""

import re
import logging
from typing import Dict, List, Tuple, Optional
from dataclasses import dataclass

logger = logging.getLogger(__name__)

@dataclass
class QuestionIntent:
    """–°—Ç—Ä—É–∫—Ç—É—Ä–∞ –¥–ª—è —Ö—Ä–∞–Ω–µ–Ω–∏—è –∞–Ω–∞–ª–∏–∑–∞ –Ω–∞–º–µ—Ä–µ–Ω–∏—è –≤–æ–ø—Ä–æ—Å–∞"""
    intent_type: str  # medical, organizational, recipe, product, greeting, etc.
    confidence: float  # —É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å –≤ –∫–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏–∏ 0-1
    keywords: List[str]  # –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
    expanded_query: str  # —Ä–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å —Å —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏
    context_hints: List[str]  # –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞
    response_tone: str  # —Ç–æ–Ω –æ—Ç–≤–µ—Ç–∞: formal, friendly, medical, etc.

class NLPProcessorLite:
    """
    –û–±–ª–µ–≥—á–µ–Ω–Ω—ã–π –∫–ª–∞—Å—Å –¥–ª—è NLP-–æ–±—Ä–∞–±–æ—Ç–∫–∏ —Å—Ç—É–¥–µ–Ω—á–µ—Å–∫–∏—Ö –≤–æ–ø—Ä–æ—Å–æ–≤
    –ë–µ–∑ –∏—Å–ø–æ–ª—å–∑–æ–≤–∞–Ω–∏—è —Ç—è–∂–µ–ª—ã—Ö ML –º–æ–¥–µ–ª–µ–π
    """
    
    def __init__(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –æ–±–ª–µ–≥—á–µ–Ω–Ω–æ–≥–æ NLP –ø—Ä–æ—Ü–µ—Å—Å–æ—Ä–∞"""
        self._init_knowledge_base()
        logger.info("‚úÖ –û–±–ª–µ–≥—á–µ–Ω–Ω—ã–π NLP –ü—Ä–æ—Ü–µ—Å—Å–æ—Ä –∏–Ω–∏—Ü–∏–∞–ª–∏–∑–∏—Ä–æ–≤–∞–Ω")
    
    def _init_knowledge_base(self):
        """–ò–Ω–∏—Ü–∏–∞–ª–∏–∑–∞—Ü–∏—è –±–∞–∑—ã –∑–Ω–∞–Ω–∏–π –¥–ª—è —Ä–∞—Å—à–∏—Ä–µ–Ω–∏—è –∑–∞–ø—Ä–æ—Å–æ–≤"""
        
        # –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Å–∏–Ω–æ–Ω–∏–º—ã –∏ —Å–≤—è–∑–∞–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
        self.medical_synonyms = {
            # –ë–æ–ª–∏ –∏ —Å–∏–º–ø—Ç–æ–º—ã
            "–±–æ–ª—å": ["–±–æ–ª–∏—Ç", "–±–æ–ª–µ–∑–Ω–µ–Ω–Ω–æ", "–Ω–µ–ø—Ä–∏—è—Ç–Ω—ã–µ –æ—â—É—â–µ–Ω–∏—è", "–¥–∏—Å–∫–æ–º—Ñ–æ—Ä—Ç", "–Ω–æ–µ—Ç", "–∫–æ–ª–µ—Ç", "—Ç—è–Ω–µ—Ç"],
            "–ø–æ–∑–≤–æ–Ω–æ—á–Ω–∏–∫": ["—Å–ø–∏–Ω–∞", "–ø–æ–∑–≤–æ–Ω–æ—á–Ω—ã–π —Å—Ç–æ–ª–±", "—Ö—Ä–µ–±–µ—Ç", "–ø–æ—è—Å–Ω–∏—Ü–∞", "–≥—Ä—É–¥–Ω–æ–π –æ—Ç–¥–µ–ª", "—à–µ–π–Ω—ã–π –æ—Ç–¥–µ–ª"],
            "—Å—É—Å—Ç–∞–≤—ã": ["—Å–æ—á–ª–µ–Ω–µ–Ω–∏—è", "–∫–æ–ª–µ–Ω–∏", "–ª–æ–∫—Ç–∏", "–ø–ª–µ—á–∏", "—Ç–∞–∑–æ–±–µ–¥—Ä–µ–Ω–Ω—ã–µ", "–≥–æ–ª–µ–Ω–æ—Å—Ç–æ–ø"],
            "–≥–æ–ª–æ–≤–Ω–∞—è –±–æ–ª—å": ["–º–∏–≥—Ä–µ–Ω—å", "—Ü–µ—Ñ–∞–ª–≥–∏—è", "–≥–æ–ª–æ–≤–Ω—ã–µ –±–æ–ª–∏", "–±–æ–ª–∏ –≤ –≥–æ–ª–æ–≤–µ", "—Ç—è–∂–µ—Å—Ç—å –≤ –≥–æ–ª–æ–≤–µ"],
            "—Ç–æ—à–Ω–æ—Ç–∞": ["–ø–æ–¥—Ç–∞—à–Ω–∏–≤–∞–µ—Ç", "—Ä–≤–æ—Ç–Ω—ã–µ –ø–æ–∑—ã–≤—ã", "—Ç–æ—à–Ω–∏—Ç", "–º—É—Ç–∏—Ç", "–¥—É—Ä–Ω–æ—Ç–∞"],
            
            # –ú–µ—Ç–æ–¥—ã –ª–µ—á–µ–Ω–∏—è
            "—Ç–µ–π–ø–∏—Ä–æ–≤–∞–Ω–∏–µ": ["–∫–∏–Ω–µ–∑–∏–æ—Ç–µ–π–ø–∏–Ω–≥", "—Ç–µ–π–ø—ã", "–ø–ª–∞—Å—Ç—ã—Ä–∏", "–∫–∏–Ω–µ–∑–∏–æ —Ç–µ–π–ø", "—Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–∏–µ –ø–ª–∞—Å—Ç—ã—Ä–∏"],
            "–º–∞—Å—Å–∞–∂": ["—Ä–∞—Å—Ç–∏—Ä–∞–Ω–∏–µ", "—Ä–∞–∑–º–∏–Ω–∞–Ω–∏–µ", "–º–∞–Ω—É–∞–ª—å–Ω–∞—è —Ç–µ—Ä–∞–ø–∏—è", "–ª–µ—á–µ–±–Ω—ã–π –º–∞—Å—Å–∞–∂"],
            "—É–ø—Ä–∞–∂–Ω–µ–Ω–∏—è": ["–≥–∏–º–Ω–∞—Å—Ç–∏–∫–∞", "–õ–§–ö", "–ª–µ—á–µ–±–Ω–∞—è —Ñ–∏–∑–∫—É–ª—å—Ç—É—Ä–∞", "–∑–∞—Ä—è–¥–∫–∞", "—Ç—Ä–µ–Ω–∏—Ä–æ–≤–∫–∏"],
            
            # –ü—Ä–æ–¥—É–∫—Ç—ã –∏ –ø–∏—Ç–∞–Ω–∏–µ
            "–¥–∏–µ—Ç–∞": ["—Ä–∞—Ü–∏–æ–Ω", "–ø–∏—Ç–∞–Ω–∏–µ", "–º–µ–Ω—é", "—Ä–µ–∂–∏–º –ø–∏—Ç–∞–Ω–∏—è"],
            "–≤–∏—Ç–∞–º–∏–Ω—ã": ["–º–∏–∫—Ä–æ—ç–ª–µ–º–µ–Ω—Ç—ã", "–¥–æ–±–∞–≤–∫–∏", "–ë–ê–î—ã", "–Ω—É—Ç—Ä–∏–µ–Ω—Ç—ã", "–º–∏–Ω–µ—Ä–∞–ª—ã"],
            "–±–µ–ª–∫–∏": ["–ø—Ä–æ—Ç–µ–∏–Ω—ã", "–∞–º–∏–Ω–æ–∫–∏—Å–ª–æ—Ç—ã", "–±–µ–ª–∫–æ–≤–∞—è –ø–∏—â–∞"],
            "—É–≥–ª–µ–≤–æ–¥—ã": ["—Å–∞—Ö–∞—Ä–∞", "–∫—Ä–∞—Ö–º–∞–ª", "–≥–ª—é–∫–æ–∑–∞", "—ç–Ω–µ—Ä–≥–∏—è"],
            "–∂–∏—Ä—ã": ["–ª–∏–ø–∏–¥—ã", "–º–∞—Å–ª–∞", "–æ–º–µ–≥–∞", "–∂–∏—Ä–Ω—ã–µ –∫–∏—Å–ª–æ—Ç—ã"]
        }
        
        # –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
        self.organizational_synonyms = {
            "–∫—É—Ä–∞—Ç–æ—Ä": ["–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å", "–Ω–∞—Å—Ç–∞–≤–Ω–∏–∫", "—Ç—å—é—Ç–æ—Ä", "—É—á–∏—Ç–µ–ª—å", "–∏–Ω—Å—Ç—Ä—É–∫—Ç–æ—Ä"],
            "–æ–±—É—á–µ–Ω–∏–µ": ["–∫—É—Ä—Å", "–ø—Ä–æ–≥—Ä–∞–º–º–∞", "–∑–∞–Ω—è—Ç–∏—è", "—É—Ä–æ–∫–∏", "–ª–µ–∫—Ü–∏–∏"],
            "—ç–∫–∑–∞–º–µ–Ω": ["–∑–∞—á–µ—Ç", "—Ç–µ—Å—Ç", "–ø—Ä–æ–≤–µ—Ä–∫–∞ –∑–Ω–∞–Ω–∏–π", "–∞—Ç—Ç–µ—Å—Ç–∞—Ü–∏—è", "–∫–æ–Ω—Ç—Ä–æ–ª—å"],
            "—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç": ["–¥–∏–ø–ª–æ–º", "—É–¥–æ—Å—Ç–æ–≤–µ—Ä–µ–Ω–∏–µ", "–¥–æ–∫—É–º–µ–Ω—Ç –æ–± –æ–±—Ä–∞–∑–æ–≤–∞–Ω–∏–∏"],
            "—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ": ["–≥—Ä–∞—Ñ–∏–∫", "–≤—Ä–µ–º—è –∑–∞–Ω—è—Ç–∏–π", "–ø–ª–∞–Ω", "–∫–∞–ª–µ–Ω–¥–∞—Ä—å"],
            "–∑–∞–¥–∞–Ω–∏–µ": ["–¥–æ–º–∞—à–Ω–µ–µ –∑–∞–¥–∞–Ω–∏–µ", "—É–ø—Ä–∞–∂–Ω–µ–Ω–∏–µ", "–ø—Ä–∞–∫—Ç–∏–∫–∞", "—Ä–∞–±–æ—Ç–∞"]
        }
        
        # –ö—É–ª–∏–Ω–∞—Ä–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
        self.cooking_synonyms = {
            "—Ä–µ—Ü–µ–ø—Ç": ["—Å–ø–æ—Å–æ–± –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è", "–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è", "–∫–∞–∫ –≥–æ—Ç–æ–≤–∏—Ç—å", "–∫–∞–∫ —Å–¥–µ–ª–∞—Ç—å"],
            "–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã": ["–ø—Ä–æ–¥—É–∫—Ç—ã", "—Å–æ—Å—Ç–∞–≤–ª—è—é—â–∏–µ", "–∫–æ–º–ø–æ–Ω–µ–Ω—Ç—ã"],
            "–ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ": ["–≥–æ—Ç–æ–≤–∫–∞", "–≤–∞—Ä–∫–∞", "–∂–∞—Ä–∫–∞", "—Ç—É—à–µ–Ω–∏–µ", "–∑–∞–ø–µ–∫–∞–Ω–∏–µ"],
            "—Å–ø–µ—Ü–∏–∏": ["–ø—Ä–∏–ø—Ä–∞–≤—ã", "–ø—Ä—è–Ω–æ—Å—Ç–∏", "—Ç—Ä–∞–≤—ã", "–∑–µ–ª–µ–Ω—å"],
            "—Å–æ—É—Å": ["–∑–∞–ø—Ä–∞–≤–∫–∞", "–ø–æ–¥–ª–∏–≤–∞", "–¥—Ä–µ—Å—Å–∏–Ω–≥", "–º–∞–π–æ–Ω–µ–∑"]
        }
        
        # –¢–∏–ø—ã –∏–Ω—Ç–µ–Ω—Ç–æ–≤ —Å –∫–ª—é—á–µ–≤—ã–º–∏ —Å–ª–æ–≤–∞–º–∏
        self.intent_patterns = {
            "medical_question": {
                "keywords": ["–±–æ–ª—å", "–±–æ–ª–∏—Ç", "—Å–∏–º–ø—Ç–æ–º", "–ª–µ—á–µ–Ω–∏–µ", "—Ç–µ–π–ø", "–º–∞—Å—Å–∞–∂", "–ø–æ–º–æ–≥–∞–µ—Ç", "–º–æ–∂–Ω–æ –ª–∏", "–ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è"],
                "patterns": [r"–±–æ–ª–∏—Ç", r"–ø–æ–º–æ–≥–∞–µ—Ç –ª–∏", r"–º–æ–∂–Ω–æ –ª–∏", r"–ª–µ—á–∏—Ç—å", r"—Ç–µ–π–ø", r"–ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω"],
                "response_tone": "medical_professional"
            },
            "organizational_question": {
                "keywords": ["–∫—É—Ä–∞—Ç–æ—Ä", "—ç–∫–∑–∞–º–µ–Ω", "—Å–µ—Ä—Ç–∏—Ñ–∏–∫–∞—Ç", "–æ–±—É—á–µ–Ω–∏–µ", "—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ", "–∫–æ–≥–¥–∞", "–≥–¥–µ", "–∫–∞–∫ –ø–æ–ª—É—á–∏—Ç—å"],
                "patterns": [r"–∫–æ–≥–¥–∞.*—ç–∫–∑–∞–º–µ–Ω", r"–∫–∞–∫.*—Å–≤—è–∑–∞—Ç—å—Å—è", r"–≥–¥–µ.*—Ä–∞—Å–ø–∏—Å–∞–Ω–∏–µ", r"—Å–∫–æ–ª—å–∫–æ.*–¥–ª–∏—Ç—Å—è"],
                "response_tone": "helpful_administrative"
            },
            "recipe_question": {
                "keywords": ["—Ä–µ—Ü–µ–ø—Ç", "–∫–∞–∫ –≥–æ—Ç–æ–≤–∏—Ç—å", "–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã", "–ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å", "–±–ª—é–¥–æ", "–º–µ–Ω—é"],
                "patterns": [r"—Ä–µ—Ü–µ–ø—Ç", r"–∫–∞–∫.*–≥–æ—Ç–æ–≤–∏—Ç—å", r"–ø—Ä–∏–≥–æ—Ç–æ–≤–∏—Ç—å", r"–∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã"],
                "response_tone": "friendly_cooking"
            },
            "product_question": {
                "keywords": ["–ø—Ä–æ–¥—É–∫—Ç", "–ø–æ–ª–µ–∑–Ω–æ", "–≤—Ä–µ–¥–Ω–æ", "–∫–∞–ª–æ—Ä–∏–∏", "—Å–æ—Å—Ç–∞–≤", "–º–æ–∂–Ω–æ –µ—Å—Ç—å"],
                "patterns": [r"–ø–æ–ª–µ–∑–Ω", r"–≤—Ä–µ–¥–Ω", r"–∫–∞–ª–æ—Ä–∏", r"–º–æ–∂–Ω–æ.*–µ—Å—Ç—å", r"—Å–æ—Å—Ç–∞–≤"],
                "response_tone": "nutritional_expert"
            },
            "greeting": {
                "keywords": ["–ø—Ä–∏–≤–µ—Ç", "–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π", "–¥–æ–±—Ä–æ", "—Å–ø–∞—Å–∏–±–æ", "–±–ª–∞–≥–æ–¥–∞—Ä—é"],
                "patterns": [r"–ø—Ä–∏–≤–µ—Ç", r"–∑–¥—Ä–∞–≤—Å—Ç–≤—É–π", r"–¥–æ–±—Ä", r"—Å–ø–∞—Å–∏–±–æ", r"–±–ª–∞–≥–æ–¥–∞—Ä"],
                "response_tone": "friendly_greeting"
            }
        }
        
    def analyze_question(self, question: str) -> QuestionIntent:
        """
        –ü–æ–ª–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–æ–ø—Ä–æ—Å–∞ —Å—Ç—É–¥–µ–Ω—Ç–∞
        
        Args:
            question: –¢–µ–∫—Å—Ç –≤–æ–ø—Ä–æ—Å–∞
            
        Returns:
            QuestionIntent: –°—Ç—Ä—É–∫—Ç—É—Ä–∏—Ä–æ–≤–∞–Ω–Ω—ã–π –∞–Ω–∞–ª–∏–∑ –≤–æ–ø—Ä–æ—Å–∞
        """
        question_lower = question.lower().strip()
        
        # 1. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–∏–ø –∏–Ω—Ç–µ–Ω—Ç–∞
        intent_type, confidence = self._classify_intent(question_lower)
        
        # 2. –ò–∑–≤–ª–µ–∫–∞–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
        keywords = self._extract_keywords(question_lower, intent_type)
        
        # 3. –†–∞—Å—à–∏—Ä—è–µ–º –∑–∞–ø—Ä–æ—Å —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏
        expanded_query = self._expand_query_with_synonyms(question, keywords, intent_type)
        
        # 4. –ì–µ–Ω–µ—Ä–∏—Ä—É–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏ –¥–ª—è –ø–æ–∏—Å–∫–∞
        context_hints = self._generate_context_hints(keywords, intent_type)
        
        # 5. –û–ø—Ä–µ–¥–µ–ª—è–µ–º —Ç–æ–Ω –æ—Ç–≤–µ—Ç–∞
        response_tone = self.intent_patterns[intent_type]["response_tone"]
        
        result = QuestionIntent(
            intent_type=intent_type,
            confidence=confidence,
            keywords=keywords,
            expanded_query=expanded_query,
            context_hints=context_hints,
            response_tone=response_tone
        )
        
        logger.info(f"üß† –ê–Ω–∞–ª–∏–∑ –≤–æ–ø—Ä–æ—Å–∞: {intent_type} (—É–≤–µ—Ä–µ–Ω–Ω–æ—Å—Ç—å: {confidence:.2f})")
        logger.info(f"üîë –ö–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞: {keywords}")
        logger.info(f"üìù –†–∞—Å—à–∏—Ä–µ–Ω–Ω—ã–π –∑–∞–ø—Ä–æ—Å: {expanded_query[:100]}...")
        
        return result
    
    def _classify_intent(self, question: str) -> Tuple[str, float]:
        """–ö–ª–∞—Å—Å–∏—Ñ–∏–∫–∞—Ü–∏—è —Ç–∏–ø–∞ –≤–æ–ø—Ä–æ—Å–∞"""
        max_score = 0
        best_intent = "general_question"
        
        for intent, config in self.intent_patterns.items():
            score = 0
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞
            for keyword in config["keywords"]:
                if keyword in question:
                    score += 2
            
            # –ü—Ä–æ–≤–µ—Ä—è–µ–º –ø–∞—Ç—Ç–µ—Ä–Ω—ã
            for pattern in config["patterns"]:
                if re.search(pattern, question, re.IGNORECASE):
                    score += 3
            
            # –ù–æ—Ä–º–∞–ª–∏–∑—É–µ–º score
            confidence = min(score / 10, 1.0)
            
            if confidence > max_score:
                max_score = confidence
                best_intent = intent
        
        return best_intent, max_score
    
    def _extract_keywords(self, question: str, intent_type: str) -> List[str]:
        """–ò–∑–≤–ª–µ—á–µ–Ω–∏–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤ –∏–∑ –≤–æ–ø—Ä–æ—Å–∞"""
        keywords = []
        
        # –ë–∞–∑–æ–≤—ã–µ –∫–ª—é—á–µ–≤—ã–µ —Å–ª–æ–≤–∞ –ø–æ —Ç–∏–ø—É –∏–Ω—Ç–µ–Ω—Ç–∞
        if intent_type in self.intent_patterns:
            intent_keywords = self.intent_patterns[intent_type]["keywords"]
            for keyword in intent_keywords:
                if keyword in question:
                    keywords.append(keyword)
        
        # –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Ç–µ—Ä–º–∏–Ω—ã
        for term, synonyms in self.medical_synonyms.items():
            if term in question or any(syn in question for syn in synonyms):
                keywords.append(term)
        
        # –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
        for term, synonyms in self.organizational_synonyms.items():
            if term in question or any(syn in question for syn in synonyms):
                keywords.append(term)
        
        # –ö—É–ª–∏–Ω–∞—Ä–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã
        for term, synonyms in self.cooking_synonyms.items():
            if term in question or any(syn in question for syn in synonyms):
                keywords.append(term)
        
        return list(set(keywords))  # —É–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
    
    def _expand_query_with_synonyms(self, original_query: str, keywords: List[str], intent_type: str) -> str:
        """–†–∞—Å—à–∏—Ä–µ–Ω–∏–µ –∑–∞–ø—Ä–æ—Å–∞ —Å–∏–Ω–æ–Ω–∏–º–∞–º–∏ –¥–ª—è —É–ª—É—á—à–µ–Ω–∏—è –ø–æ–∏—Å–∫–∞"""
        expanded_parts = [original_query]
        
        # –î–æ–±–∞–≤–ª—è–µ–º —Å–∏–Ω–æ–Ω–∏–º—ã –Ω–∞–π–¥–µ–Ω–Ω—ã—Ö –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
        for keyword in keywords:
            synonyms = []
            
            # –ú–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ —Å–∏–Ω–æ–Ω–∏–º—ã
            if keyword in self.medical_synonyms:
                synonyms.extend(self.medical_synonyms[keyword][:3])  # –±–µ—Ä–µ–º –ø–µ—Ä–≤—ã–µ 3
            
            # –û—Ä–≥–∞–Ω–∏–∑–∞—Ü–∏–æ–Ω–Ω—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã
            if keyword in self.organizational_synonyms:
                synonyms.extend(self.organizational_synonyms[keyword][:3])
            
            # –ö—É–ª–∏–Ω–∞—Ä–Ω—ã–µ —Å–∏–Ω–æ–Ω–∏–º—ã
            if keyword in self.cooking_synonyms:
                synonyms.extend(self.cooking_synonyms[keyword][:3])
            
            if synonyms:
                expanded_parts.append(" ".join(synonyms))
        
        # –î–æ–±–∞–≤–ª—è–µ–º –∫–æ–Ω—Ç–µ–∫—Å—Ç–Ω—ã–µ —Ç–µ—Ä–º–∏–Ω—ã –ø–æ —Ç–∏–ø—É –∏–Ω—Ç–µ–Ω—Ç–∞
        context_terms = {
            "medical_question": ["–ª–µ—á–µ–Ω–∏–µ", "—Ç–µ—Ä–∞–ø–∏—è", "–ø–æ–∫–∞–∑–∞–Ω–∏—è", "—ç—Ñ—Ñ–µ–∫—Ç–∏–≤–Ω–æ—Å—Ç—å"],
            "organizational_question": ["–∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—è", "–ø—Ä–∞–≤–∏–ª–∞", "–ø—Ä–æ—Ü–µ–¥—É—Ä–∞", "—Ç—Ä–µ–±–æ–≤–∞–Ω–∏—è"],
            "recipe_question": ["–ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ", "–∫—É–ª–∏–Ω–∞—Ä–∏—è", "—Å–ø–æ—Å–æ–±", "–º–µ—Ç–æ–¥"],
            "product_question": ["—Å–≤–æ–π—Å—Ç–≤–∞", "–ø–æ–ª—å–∑–∞", "–ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ", "—Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"]
        }
        
        if intent_type in context_terms:
            expanded_parts.append(" ".join(context_terms[intent_type]))
        
        return " ".join(expanded_parts)
    
    def _generate_context_hints(self, keywords: List[str], intent_type: str) -> List[str]:
        """–ì–µ–Ω–µ—Ä–∞—Ü–∏—è –ø–æ–¥—Å–∫–∞–∑–æ–∫ –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞ –∫–æ–Ω—Ç–µ–∫—Å—Ç–∞"""
        hints = []
        
        # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏ –Ω–∞ –æ—Å–Ω–æ–≤–µ –∫–ª—é—á–µ–≤—ã—Ö —Å–ª–æ–≤
        for keyword in keywords:
            if keyword in ["–±–æ–ª—å", "–±–æ–ª–∏—Ç"]:
                hints.extend(["–±–æ–ª–µ–≤–æ–π —Å–∏–Ω–¥—Ä–æ–º", "–æ–±–µ–∑–±–æ–ª–∏–≤–∞–Ω–∏–µ", "–∞–Ω–∞–ª—å–≥–µ–∑–∏—è"])
            elif keyword in ["—Ç–µ–π–ø–∏—Ä–æ–≤–∞–Ω–∏–µ", "—Ç–µ–π–ø"]:
                hints.extend(["–∫–∏–Ω–µ–∑–∏–æ—Ç–µ–π–ø–∏–Ω–≥", "—Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–æ–µ —Ç–µ–π–ø–∏—Ä–æ–≤–∞–Ω–∏–µ", "—Ä–µ–∞–±–∏–ª–∏—Ç–∞—Ü–∏—è"])
            elif keyword in ["–∫—É—Ä–∞—Ç–æ—Ä", "–ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—å"]:
                hints.extend(["—Å–≤—è–∑—å —Å –∫—É—Ä–∞—Ç–æ—Ä–æ–º", "–∫–æ–Ω—Ç–∞–∫—Ç—ã", "–æ–±—Ä–∞—â–µ–Ω–∏–µ –∫ –ø—Ä–µ–ø–æ–¥–∞–≤–∞—Ç–µ–ª—é"])
            elif keyword in ["—Ä–µ—Ü–µ–ø—Ç", "–ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ"]:
                hints.extend(["–∫—É–ª–∏–Ω–∞—Ä–Ω—ã–π —Ä–µ—Ü–µ–ø—Ç", "—Å–ø–æ—Å–æ–± –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏—è", "–∏–Ω—Å—Ç—Ä—É–∫—Ü–∏—è"])
        
        # –î–æ–±–∞–≤–ª—è–µ–º –ø–æ–¥—Å–∫–∞–∑–∫–∏ –ø–æ —Ç–∏–ø—É –∏–Ω—Ç–µ–Ω—Ç–∞
        intent_hints = {
            "medical_question": ["–º–µ–¥–∏—Ü–∏–Ω—Å–∫–∏–µ –ø–æ–∫–∞–∑–∞–Ω–∏—è", "—Ç–µ—Ä–∞–ø–µ–≤—Ç–∏—á–µ—Å–∫–æ–µ –ø—Ä–∏–º–µ–Ω–µ–Ω–∏–µ", "–∫–ª–∏–Ω–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"],
            "organizational_question": ["—É—á–µ–±–Ω—ã–π –ø—Ä–æ—Ü–µ—Å—Å", "–∞–¥–º–∏–Ω–∏—Å—Ç—Ä–∞—Ç–∏–≤–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã", "—Ä–µ–≥–ª–∞–º–µ–Ω—Ç"],
            "recipe_question": ["–∫—É–ª–∏–Ω–∞—Ä–Ω—ã–µ —Ä–µ—Ü–µ–ø—Ç—ã", "–ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ –ø–∏—â–∏", "–ø–∏—â–µ–≤—ã–µ —Ç–µ—Ö–Ω–æ–ª–æ–≥–∏–∏"],
            "product_question": ["–ø–∏—â–µ–≤—ã–µ –ø—Ä–æ–¥—É–∫—Ç—ã", "–Ω—É—Ç—Ä–∏–µ–Ω—Ç–Ω—ã–π —Å–æ—Å—Ç–∞–≤", "–¥–∏–µ—Ç–∏—á–µ—Å–∫–∏–µ —Ä–µ–∫–æ–º–µ–Ω–¥–∞—Ü–∏–∏"]
        }
        
        if intent_type in intent_hints:
            hints.extend(intent_hints[intent_type])
        
        return list(set(hints))  # —É–±–∏—Ä–∞–µ–º –¥—É–±–ª–∏–∫–∞—Ç—ã
    
    def enhance_search_query(self, original_query: str) -> Dict[str, str]:
        """
        –°–æ–∑–¥–∞–µ—Ç –Ω–µ—Å–∫–æ–ª—å–∫–æ –≤–∞—Ä–∏–∞–Ω—Ç–æ–≤ –ø–æ–∏—Å–∫–æ–≤–æ–≥–æ –∑–∞–ø—Ä–æ—Å–∞ –¥–ª—è –±–æ–ª–µ–µ —Ç–æ—á–Ω–æ–≥–æ –ø–æ–∏—Å–∫–∞
        
        Returns:
            Dict —Å —Ä–∞–∑–ª–∏—á–Ω—ã–º–∏ –≤–∞—Ä–∏–∞–Ω—Ç–∞–º–∏ –∑–∞–ø—Ä–æ—Å–∞
        """
        intent = self.analyze_question(original_query)
        
        return {
            "original": original_query,
            "expanded": intent.expanded_query,
            "keywords_only": " ".join(intent.keywords),
            "context_hints": " ".join(intent.context_hints),
            "combined": f"{original_query} {' '.join(intent.keywords)} {' '.join(intent.context_hints[:3])}"
        }
    
    def suggest_related_questions(self, question: str, found_docs: List[str]) -> List[str]:
        """
        –ü—Ä–µ–¥–ª–∞–≥–∞–µ—Ç —Å–≤—è–∑–∞–Ω–Ω—ã–µ –≤–æ–ø—Ä–æ—Å—ã –Ω–∞ –æ—Å–Ω–æ–≤–µ –Ω–∞–π–¥–µ–Ω–Ω–æ–≥–æ –∫–æ–Ω—Ç–µ–Ω—Ç–∞
        """
        intent = self.analyze_question(question)
        suggestions = []
        
        # –ë–∞–∑–æ–≤—ã–µ –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏—è –ø–æ —Ç–∏–ø—É –∏–Ω—Ç–µ–Ω—Ç–∞
        if intent.intent_type == "medical_question":
            suggestions = [
                "–ö–∞–∫–∏–µ –µ—Å—Ç—å –ø—Ä–æ—Ç–∏–≤–æ–ø–æ–∫–∞–∑–∞–Ω–∏—è –∫ —ç—Ç–æ–º—É –º–µ—Ç–æ–¥—É?",
                "–ö–∞–∫ –¥–æ–ª–≥–æ –ø—Ä–∏–º–µ–Ω—è—Ç—å —ç—Ç–æ –ª–µ—á–µ–Ω–∏–µ?",
                "–ï—Å—Ç—å –ª–∏ –ø–æ–±–æ—á–Ω—ã–µ —ç—Ñ—Ñ–µ–∫—Ç—ã?"
            ]
        elif intent.intent_type == "organizational_question":
            suggestions = [
                "–ì–¥–µ –Ω–∞–π—Ç–∏ –ø–æ–¥—Ä–æ–±–Ω—É—é –∏–Ω—Ñ–æ—Ä–º–∞—Ü–∏—é –æ–± —ç—Ç–æ–º?",
                "–ö –∫–æ–º—É –æ–±—Ä–∞—Ç–∏—Ç—å—Å—è –∑–∞ –ø–æ–º–æ—â—å—é?",
                "–ö–∞–∫–∏–µ –¥–æ–∫—É–º–µ–Ω—Ç—ã –Ω—É–∂–Ω—ã?"
            ]
        elif intent.intent_type == "recipe_question":
            suggestions = [
                "–ö–∞–∫–∏–µ –µ—Å—Ç—å –∞–ª—å—Ç–µ—Ä–Ω–∞—Ç–∏–≤–Ω—ã–µ –∏–Ω–≥—Ä–µ–¥–∏–µ–Ω—Ç—ã?",
                "–°–∫–æ–ª—å–∫–æ –≤—Ä–µ–º–µ–Ω–∏ –∑–∞–π–º–µ—Ç –ø—Ä–∏–≥–æ—Ç–æ–≤–ª–µ–Ω–∏–µ?",
                "–ú–æ–∂–Ω–æ –ª–∏ –∏–∑–º–µ–Ω–∏—Ç—å —Ä–µ—Ü–µ–ø—Ç?"
            ]
        
        return suggestions[:3]  # –≤–æ–∑–≤—Ä–∞—â–∞–µ–º –Ω–µ –±–æ–ª–µ–µ 3 –ø—Ä–µ–¥–ª–æ–∂–µ–Ω–∏–π

# –î–ª—è –æ–±—Ä–∞—Ç–Ω–æ–π —Å–æ–≤–º–µ—Å—Ç–∏–º–æ—Å—Ç–∏
NLPProcessor = NLPProcessorLite
